Must like 4a, it translates the embedded packet based on the active mapping so that it has the expected form. It then translates the outer/top ip layer by replacing the source ip address so that the ICMP Error appears to come from the correct host. This source ip is the public ip of the NAT, unless the NAT enforces a Basic NAT function, and has an active mapping for the source ip prior to translating. In that case it uses the public ip in that mapping.
